{"version":3,"sources":["examples/Basic.tsx","ControllerView.ts","LocalStoragePersistentStrategy.ts","Store.ts","Pool.ts","ManagedState.ts"],"names":[],"mappings":"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","file":"","sourcesContent":["import {createControllerView} from '../ControllerView'; \r\nimport {localStorageStrategy} from '../LocalStoragePersistentStrategy'; \r\nimport {createStore} from '../Store'; \r\nimport {render,Component,h} from 'preact'; \r\n\r\nclass Dino extends Component<any,any>{\r\n    constructor(p){\r\n        super(p);\r\n        this.onChange = this.onChange.bind(this);\r\n    }\r\n    onChange(e){\r\n        let el = e.currentTarget; \r\n        this.props.onChange(el.value); \r\n    }\r\n    render({value}){\r\n        return (\r\n            h('div',{'class':'bit'},[\r\n                h('div',{'class':'input'},\r\n                    h('input',{type:'number',\r\n                        onChange:this.onChange, \r\n                        value:value}))\r\n            ])\r\n        );\r\n    }\r\n}\r\n\r\nfunction onChange(e:string){\r\n\r\n}\r\n\r\nclass Basic extends Component<any,any>{\r\n    constructor(props){\r\n        super(props); \r\n        this.onChange = this.onChange.bind(this); \r\n        this.onClick = this.onClick.bind(this); \r\n    }\r\n\r\n    componentDidMount(){\r\n        // console.log(this.props);\r\n    }\r\n\r\n    onClick(){\r\n        this.props.store.dispatch({ \r\n            type:1,\r\n            data:2222\r\n        });\r\n    }\r\n\r\n    onChange(txt:string){\r\n        this.props.store.dispatch({\r\n            type:1,\r\n            data:txt\r\n        });\r\n    }\r\n\r\n    render(){\r\n        let {data} = this.props;\r\n        return (\r\n            h('div',{'class':'container'},[\r\n                h('div',{\r\n                    onClick:this.onClick\r\n                },'Click me'),\r\n                h(Dino,{\r\n                    onChange:this.onChange,\r\n                    value:data.input\r\n                })\r\n            ])\r\n        );\r\n        \r\n    }\r\n}\r\n\r\nlet cx = localStorageStrategy(); \r\n\r\nlet div = document.createElement('div'); \r\ndocument.body.appendChild(div); \r\nlet store = createStore({\r\n    ready:true,\r\n    trackChanges:false,\r\n    middlewares:[]\r\n});\r\n\r\nconst CV = createControllerView({\r\n    component:Basic,\r\n    initialState:{\r\n        name:'Borqa',\r\n        input:0,\r\n    },\r\n    reducer:(state,action)=>{\r\n        state.$set('input',action.data);\r\n    },\r\n    stateKey:'basic'\r\n\r\n});\r\nlet root = render(h(CV,{store:store,injector:null,persistenceStrategy:cx}),div);\r\n\r\nvar i = 0; \r\n\r\nvar count = 0; \r\n\r\nfunction tick(){\r\n    count++;\r\n    if (count === 2){\r\n        i++;\r\n        store.dispatch({\r\n            type:1,\r\n            data:i\r\n        });\r\n        count = 0; \r\n\r\n    } \r\n\r\n    requestAnimationFrame(tick);\r\n}\r\n\r\n// requestAnimationFrame(tick);\r\nconst TX = function(){return h('h1',{},'Suhail')}; \r\nsetTimeout(()=>{\r\n    console.log('blah');\r\n    console.log(div);\r\n    render(h(TX,{}),div,root);\r\n},2000);","import {Component,render,VNode,ComponentConstructor,\r\n\tFunctionalComponent,h} from 'preact';\r\nimport {Action} from './Action'; \r\nimport {IStore,StoreCfg} from './Store'; \r\nimport {IManagedState} from './ManagedState'; \r\nimport {DependencyContainer} from './Injector'; \r\nimport {IMiddleware,IMiddlewareNext} from './Middleware'; \r\nimport {PersistenceStrategy,FunctionalPersistenceStrategy} from './PersistenceStrategy'; \r\n\r\n/**\r\n * Properties that will be passed to the wrapped controller components. \r\n * The state of the wrapping component will be passed inside `data`. \r\n */\r\nexport interface ControllerProps<V>{\r\n\t/**\r\n\t * The data as passed by the wrapping controller component. \r\n\t */\r\n\tdata:V; \r\n\t/**\r\n\t * The store of the application.\r\n\t */\r\n\tstore:IStore; \r\n}\r\n\r\n/**\r\n * Default properties of {ControllerView} components\r\n * \r\n * @export\r\n * @interface ControllerViewProps\r\n */\r\nexport interface ControllerViewProps<T> {\r\n\t/**\r\n\t * \r\n\t * @type {Store}\r\n\t */\r\n\tstore:IStore;\r\n\r\n\tpersistenceStrategy?:PersistenceStrategy|FunctionalPersistenceStrategy<T>;\r\n\r\n\tinjector:DependencyContainer; \r\n\r\n}\r\n\r\nexport interface ControllerViewConfig<T,V> {\r\n\treducer?(state:any,action:Action):void;\r\n\tinitialState:V;\r\n\tstateKey:string;\r\n\tcomponent:ComponentConstructor<T,V>|FunctionalComponent<T>;\r\n\tdeps?:string[]|Dictionary<string>;\r\n\tpropsToPropagate?:string[];\r\n\tpropsModifier?<W extends ControllerViewProps<V>>(props:W,dest:Dictionary<any>):void;\r\n}\r\n\r\nexport function createControllerView<T extends ControllerProps<V>,V,W extends ControllerViewProps<V>>({\r\n\tcomponent,\r\n\treducer,\r\n\tinitialState,\r\n\tdeps,propsModifier,\r\n\tpropsToPropagate,\r\n\tstateKey}:ControllerViewConfig<T,V>){\r\n\tvar store:IStore = null; \r\n\tvar injector:DependencyContainer = null; \r\n\tvar propsObject:ControllerProps<V> = {\r\n\t\tdata:null,\r\n\t\tstore:null,\r\n\t}; \r\n\r\n\treturn class extends Component<W,V>{\r\n\t\tconstructor(props:W){\r\n\t\t\tsuper(props); \r\n\t\t\tthis.state = initialState; \r\n\t\t\tstore = props.store; \r\n\t\t\tinjector = props.injector; \r\n\t\t\tpropsObject.store = props.store;\r\n\t\t\tthis.propagateProps(props); \r\n\t\t\t\r\n\t\t\tif (deps && injector){\r\n\t\t\t\tif (deps instanceof Array){\r\n\t\t\t\t\tdeps.forEach((e)=>{\r\n\t\t\t\t\t\tpropsObject[e] = injector.get(e)\r\n\t\t\t\t\t})\r\n\t\t\t\t}else if (typeof deps === \"object\") {\r\n\t\t\t\t\tfor(let kk in deps){\r\n\t\t\t\t\t\tpropsObject[deps[kk]] = injector.get(kk);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpropagateProps(props:W){\r\n\t\t\tif (propsToPropagate && \r\n\t\t\t\tpropsToPropagate instanceof Array){\r\n\t\t\t\tpropsToPropagate.forEach((e)=>{\r\n\t\t\t\t\tpropsObject[e] = props[e]; \r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (propsModifier && \r\n\t\t\t\ttypeof propsModifier === \"function\"){\r\n\t\t\t\tpropsModifier<W>(props,propsObject); \r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgetStateKey(){\r\n\t\t\treturn stateKey; \r\n\t\t}\r\n\r\n\t\tgetReducer(){\r\n\t\t\treturn reducer; \r\n\t\t}\r\n\r\n\t\tcomponentWillReceiveProps(props){\r\n\t\t\tthis.propagateProps(props); \r\n\t\t}\r\n\r\n\t\tcomponentDidMount(){\r\n\t\t\tstore.connect<T,V>(this);\r\n\t\t\tconst persistenceStrategy = this.props.persistenceStrategy; \r\n\t\t\tif (persistenceStrategy){\r\n\t\t\t\tif (typeof persistenceStrategy === \"function\"){\r\n\t\t\t\t\t(persistenceStrategy as FunctionalPersistenceStrategy<V>)(stateKey,(err,data)=>{\r\n\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\tconsole.error(err.message,err.stack); \r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setState(data);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (typeof persistenceStrategy === \"object\"){\r\n\t\t\t\t\tlet persist:PersistenceStrategy = persistenceStrategy as any; \r\n\t\t\t\t\tif (typeof persist.get === \"function\"){\r\n\t\t\t\t\t\tif (persist.get.length === 2){\r\n\t\t\t\t\t\t\tpersist.get(stateKey,(err,data)=>{\r\n\t\t\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\t\t\tthrow err; \r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.setState(data); \r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}else if (persist.get.length === 1){\r\n\t\t\t\t\t\t\treturn persist.get(stateKey).then((data)=>{\r\n\t\t\t\t\t\t\t\tthis.setState(data); \r\n\t\t\t\t\t\t\t},(err)=>{\r\n\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcomponentWillUnmount(){\r\n\t\t\tlet state = this.state; \r\n\t\t\tconst persistenceStrategy = this.props.persistenceStrategy; \r\n\t\t\tif (typeof persistenceStrategy === \"function\"){\r\n\t\t\t\t(persistenceStrategy as FunctionalPersistenceStrategy<V>)(stateKey,state,(err,data)=>{\r\n\t\t\t\t\tstore.disconnect<T,V>(this);\r\n\t\t\t\t\tif (err){\r\n\t\t\t\t\t\tthrow err;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn; \r\n\t\t\t}else if (typeof persistenceStrategy === \"object\" && \r\n\t\t\t\t(persistenceStrategy as any).get !== \"undefined\"){\r\n\t\t\t\tlet p:PersistenceStrategy = persistenceStrategy as any; \r\n\t\t\t\tif (p.put.length === 2) {\r\n\t\t\t\t\tp.put(stateKey,state).then((data)=>{\r\n\t\t\t\t\t\tstore.disconnect<T,V>(this);\r\n\t\t\t\t\t},(err)=>{\r\n\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn; \r\n\t\t\t\t} else if (p.put.length === 3) {\r\n\t\t\t\t\tp.put(stateKey,state,(err,data)=>{\r\n\t\t\t\t\t\tstore.disconnect<T,V>(this);\r\n\t\t\t\t\t\tif (err){\r\n\t\t\t\t\t\t\tthrow err; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn; \r\n\t\t\t\t} \r\n\t\t\t} \r\n\t\t\tstore.disconnect<T,V>(this);\r\n\t\t}\r\n\r\n\t\trender(props:W,state:V){\r\n\t\t\tpropsObject.data = state; \r\n\t\t\t(propsObject as any).routeParams = (this.props as any).routeParams;\r\n\t\t\treturn h(component as any,\r\n\t\t\t\tpropsObject,\r\n\t\t\t\tthis.props.children); \r\n\t\t}\r\n\t}\r\n}","import {PersistenceStrategy} from './PersistenceStrategy'; \r\n/**\r\n * Creates a persistence storage based on the localStorage. \r\n * @returns {PersistenceStrategy}\r\n */\r\nexport function localStorageStrategy():PersistenceStrategy{\r\n    function get(key:string){\r\n        return new Promise((resolve,reject)=>{\r\n            let v = localStorage.getItem(key); \r\n            if (v){\r\n                resolve(JSON.parse(v));\r\n                return;\r\n            }\r\n            reject();\r\n        });\r\n    }\r\n\r\n    function put(key:string,data:any){\r\n        return new Promise((resolve,reject)=>{\r\n            localStorage.setItem(key,JSON.stringify(data));\r\n            resolve();\r\n        });\r\n    }\r\n\r\n    return {\r\n        get,\r\n        put\r\n    }\r\n}","import {createPool,Pool} from './Pool'; \r\nimport {Reducer} from './Reducer';\r\nimport {IMiddleware} from './Middleware';\r\nimport {IManagedState,createManagedState} from './ManagedState'; \r\nimport {StatefulComponent} from './StatefulComponent';\r\nimport {Action} from './Action';\r\n\r\n/**\r\n * A function that consumes an {@link Action}\r\n */\r\nexport interface ActionConsumer {\r\n\t(action:Action):void; \r\n}\r\n\r\n/**\r\n * A function that receives an action consumer {@link ActionConsume} which is \r\n * then called with an action. \r\n */\r\nexport interface ActionReceiver{\r\n\t(fn:ActionConsumer):void;\r\n}\r\n\r\n/**\r\n * Represents store configuration options \r\n */\r\nexport interface StoreCfg {\r\n\t/**\r\n\t * @type {boolean} \r\n\t * @description whether the store is ready to execute actions. \r\n\t */\r\n\tready?:boolean; \r\n\t/**\r\n\t * @type {boolean}\r\n\t * @description whether the store to track changes.\r\n\t */\r\n\ttrackChanges?:boolean; \r\n\t/**\r\n\t * @type {Array<Middleware>} \r\n\t * @description an array of middlewares to add to the store. \r\n\t */\r\n\tmiddlewares?:IMiddleware[];\r\n}\r\n\r\n/**\r\n * An action handler interface \r\n */\r\nexport interface ActionHandler<T> {\r\n\t(data:T):Action|ActionReceiver|Promise<Action>;\r\n}\r\n\r\n/**\r\n * A state container store \r\n */\r\nexport interface IStore {\r\n\t/**\r\n\t * Connects a component to the store. \r\n\t * @param {StatefulComponent<T>} el the component to connect to the store. \r\n\t * @returns {IStore} the store instance. \r\n\t */\r\n\tconnect<T,V>(el:StatefulComponent<T,V>):this;\r\n\t/**\r\n\t * Disconnects a component from the store. \r\n\t * @param {StatefulComponent<T>} el the component to disconnect. \r\n\t * @returns {IStore} the store instance. \r\n\t */ \r\n\tdisconnect<T,V>(el:StatefulComponent<T,V>):this; \r\n\t/**\r\n\t * Set the state of a specific component within the state. \r\n\t * @param {string} key the component's key. \r\n\t * @param {T} val the updated state. \r\n\t * @returns {IStore} the store instance; \r\n\t */\r\n\tsetStateAt<T>(key:string,val:T):this; \r\n\t/**\r\n\t * Get the state of a specific component. \r\n\t * @param {string} key the component's key. \r\n\t * @returns {T} the state of the component. \r\n\t */\r\n\tgetStateAt<T>(key:string):T; \r\n\t/**\r\n\t * Dispatches an action within the store. \r\n\t * @param {Action} action the action to dispatch. \r\n\t * @throws {Error} if no action is provided \r\n\t */\r\n\tdispatch(action:Action|Promise<Action>|ActionReceiver):void;  \r\n\t/**\r\n\t * Dispatches an action within the store. \r\n\t * @param {string} key the key to the specific state to be passed to the consumer\r\n\t * @param {ActionHandler} handler a higher-order function that receives the specific part of the state. \r\n\t */\r\n\tdispatch<T>(key:string,action:ActionHandler<T>):void; \r\n\t/**\r\n\t * Sets the store to be ready to execute actions. \r\n\t */\r\n\tready():void;\r\n}\r\n\r\n/**\r\n * Creates a state container instance with the provided configurations\r\n * @param {StoreCfg} cfg the store configurations. \r\n * @returns {IStore} \r\n */\r\nexport function createStore(cfg:StoreCfg):IStore{\r\n\tlet components:Dictionary<StatefulComponent<any,any>> = {}; \r\n\tlet actions:Dictionary<Action> = {}; \r\n\tlet backlog:Action[] = [];\r\n\tlet middlewares:IMiddleware[] = cfg.middlewares || [];\r\n\tlet isReady = typeof cfg.ready === \"undefined\"?true:cfg.ready; \r\n\tlet trackChanges = typeof cfg.trackChanges === \"undefined\"?false:cfg.trackChanges; \r\n\tlet o:IStore = null;\r\n\tlet queue:Action[] = [];\r\n\tlet pool = createPool(createManagedState); \r\n\r\n\tfunction connect<T,V>(el:StatefulComponent<T,V>):IStore{\r\n\t\tcomponents[el.getStateKey()] = el; \r\n\t\treturn o; \r\n\t} \r\n\r\n\tfunction disconnect<T,V>(el:StatefulComponent<T,V>):IStore{\r\n\t\tdelete components[el.getStateKey()]; \r\n\t\treturn o;\r\n\t}\r\n\r\n\tfunction getStateAt<T>(key:string){\r\n\t\treturn components[key].state; \r\n\t}\r\n\r\n\tfunction setStateAt<T>(key:string,val:T):IStore{\r\n\t\tif (components[key]){\r\n\t\t\tcomponents[key].setState(val);\r\n\t\t\treturn o; \r\n\t\t}\r\n\t\tthrow new Error(`Component with key ${key} could not be found`); \r\n\t}\r\n\r\n\tfunction applyMiddleware(action:Action,done:(action:Action|null|undefined)=>void):void{\r\n\t\tlet idx = 0; \r\n\t\tlet m:IMiddleware = null;\r\n\r\n\t\tfunction next(action?:Action){\r\n\t\t\tif (!action || idx >= middlewares.length){\r\n\t\t\t\treturn done(action); \r\n\t\t\t}\r\n\t\t\tm = middlewares[idx]; \r\n\t\t\tidx++; \r\n\t\t\treturn m(action,o,next);\r\n\t\t}\r\n\r\n\t\tnext(action); \r\n\t}\r\n\r\n\tfunction execute(action){\r\n\t\tif (action){\r\n\t\t\tif (trackChanges){\r\n\t\t\t\tbacklog.push(action);\r\n\t\t\t}\r\n\t\t\tlet managedState = pool.get();\r\n\t\t\tfor(var key in components){\r\n\t\t\t\tmanagedState.setState(components[key].state); \r\n\t\t\t\tlet rd = components[key].getReducer();\r\n\t\t\t\tif (rd){\r\n\t\t\t\t\trd(managedState,action);\r\n\t\t\t\t\tif (managedState.hasChanges){\r\n\t\t\t\t\t\tcomponents[key].setState(managedState.changes());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpool.put(managedState);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ready(){\r\n\t\tisReady = true; \r\n\t\tlet action:Action = null;\r\n\t\twhile((action = queue.shift())){\r\n\t\t\tdispatch.apply(null,action);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onAction(action:Action){\r\n\t\tlet act = applyMiddleware(action,(finalAction)=>{\r\n\t\t\tfinalAction && execute(finalAction); \r\n\t\t}); \r\n\t}\r\n\r\n\tfunction onActionFail(err:Error){\r\n\t\tconsole.log(err,err.message,err.stack);\r\n\t}\r\n\r\n\tfunction dispatch(action:ActionReceiver|Action|Promise<Action>):void;\r\n\tfunction dispatch<T>(key:string,action:ActionHandler<T>):void;\r\n\tfunction dispatch(...args:any[]){\r\n\t\tif (!isReady){\r\n\t\t\tqueue.push(Array.prototype.slice.call(args,0));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (args.length === 0){\r\n\t\t\tthrow new Error(`No action provided`); \r\n\t\t}else if (args.length === 1){\r\n\t\t\tif (typeof args[0] === \"function\"){\r\n\t\t\t\targs[0](onAction);\r\n\t\t\t}else if (typeof args[0] === \"object\"){\r\n\t\t\t\tif (args[0].type){\r\n\t\t\t\t\tonAction(args[0]);\r\n\t\t\t\t}else if (args[0].then && typeof args[0].then === \"function\"){\r\n\t\t\t\t\targs[0].then(onAction,onActionFail);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}else if (args.length === 2){\r\n\t\t\tif ((typeof args[0] === \"string\" || \r\n\t\t\t\ttypeof args[0] === \"number\") && \r\n\t\t\t\ttypeof args[1] !== \"object\") {\r\n\t\t\t\tonAction({\r\n\t\t\t\t\ttype:args[0],\r\n\t\t\t\t\tdata:args[1]\r\n\t\t\t\t});\r\n\t\t\t} else if (typeof args[0] === \"string\" && \r\n\t\t\t\ttypeof args[1] === \"function\"){\r\n\t\t\t\tlet st = components[args[0]] && components[args[0]].state; \r\n\t\t\t\tlet a = args[1](st,onAction);\r\n\t\t\t\tif (a && a.type){\r\n\t\t\t\t\tonAction(a);\r\n\t\t\t\t}else if (typeof a === \"object\" && \r\n\t\t\t\t\ttypeof a.then === \"function\"){\r\n\t\t\t\t\ta.then(onAction,onActionFail); \r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\to = {\r\n\t\tconnect,\r\n\t\tdisconnect,\r\n\t\tgetStateAt,\r\n\t\tsetStateAt,\r\n\t\tdispatch,\r\n\t\tready,\r\n\t}; \r\n\r\n\treturn o; \r\n}","/**\r\n * An object pool \r\n */\r\nexport interface Pool<V> {\r\n    /**\r\n     * Returns an object from the pool. \r\n     * @param {any} v an optional to be passed to the generator function if provided. Otherwise, it is ignored. \r\n     * @returns {V} \r\n     */\r\n    get(v?:any):V;  \r\n    /**\r\n     * Adds an object to the pool. \r\n     * @param {V} v object to add \r\n     */\r\n    put(v:V):void; \r\n}\r\n/**\r\n * Creates an object pool to help with object reuse. \r\n * This is to optimise garabage collection in JS application. \r\n * @param {function} make an object generator function. If provided, the function will be called when no the pool is empty.\r\n * @returns {Pool}\r\n */\r\nexport function createPool<T>(make?:(...args:any[])=>T):Pool<T>{\r\n\tlet pool:any[] = []; \r\n\tfunction get(d?:any):T{\r\n\t\tif (pool.length === 0){\r\n\t\t\tlet v = (make && make(d)) || {};\r\n\t\t\treturn v as any; \r\n\t\t}\r\n\t\treturn pool.shift();\r\n\t}\r\n\r\n\tfunction put(o:T){\r\n\t\tpool.push(o); \r\n\t}\r\n\treturn {\r\n\t\tget,\r\n\t\tput,\r\n\t}\r\n}","declare global {\r\n    interface Dictionary<T>{\r\n        [idx:string]:T;\r\n    }\r\n}\r\n/**\r\n * Represents an internal state used by the state container to emulate immutability. \r\n */\r\nexport interface IManagedState {\r\n\t/**\r\n\t * Sets a specific attribute on the state. \r\n\t * @param {string} key the key to set its value. \r\n\t * @param {any} val the value of the state. \r\n\t * @returns {IManagedState} the managed state instance. Useful for chaining changes. \r\n\t */\r\n\t$set<T>(key:string,val:T):this;\r\n\t/**\r\n\t * Gets a specific attribute in the state. \r\n\t * @param {string} key the key to get its value. \r\n\t * @returns {any} the value at the provided key. \r\n\t */\r\n\t$get<T>(key:string):T;\r\n\t/**\r\n\t * Sets the state object managed by this managed state. \r\n\t * @param {any} st the new state. \r\n\t * @returns {IManagedState} the managed state instance. \r\n\t */\r\n\tsetState<T>(st:T):this;\r\n\t/**\r\n\t * Checks whether the managed state has any changes or not. \r\n\t * @returns {boolean} \r\n\t */\r\n\thasChanges():boolean; \r\n\t/**\r\n\t * Returns the changes made to the managed state. \r\n\t * @returns {Dictionary<any>} \r\n\t */\r\n\tchanges():Dictionary<any>;\r\n}\r\n\r\n\r\n/**\r\n * Creates a managed state object \r\n * @param {any} s the initial state to manage \r\n * @returns {IManagedState} \r\n */\r\nexport function createManagedState<X>(s?:X):IManagedState{\r\n\tlet state:X = s || null; \r\n\tlet _changes:Dictionary<any> = {};\r\n\tlet o:IManagedState; \r\n\tlet _hasChanges = false; \r\n\r\n\tfunction $set<T>(key:string,val:T){\r\n\t\tif (state[key] !== val){\r\n\t\t\t_changes[key] = val; \r\n\t\t\t_hasChanges = true;\r\n\t\t}\r\n\t\treturn o; \r\n\t}\r\n\r\n\tfunction $get<T>(key:string){\r\n\t\treturn state[key]; \r\n\t}\r\n\r\n\tfunction setState(st:X){\r\n\t\t_hasChanges = false; \r\n\t\t_changes = {};\r\n\t\tstate = st; \r\n\t\treturn o; \r\n\t}\r\n\r\n\tfunction hasChanges(){\r\n\t\treturn _hasChanges; \r\n\t}\r\n\r\n\tfunction changes(){\r\n\t\treturn _changes;\r\n\t}\r\n\r\n\to = {\r\n\t\tsetState,\r\n\t\t$set,\r\n\t\t$get,\r\n\t\thasChanges,\r\n\t\tchanges\r\n\t};\r\n\r\n\treturn o; \r\n}"]}